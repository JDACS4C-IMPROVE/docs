<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>How to run a container &mdash; IMPROVE 0.1 documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to build a container" href="building-containers.html" />
    <link rel="prev" title="Tutorial CANDLE_DATA_DIR" href="using-candle-data-dir.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            IMPROVE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="whatis.html">What is the IMPROVE project?</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing IMPROVE</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="curating_introduction.html">Introduction to Curating a Community Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="curating.html">Curating a Community Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="candle_1.html">Creating a CANDLE Benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="candle_2.html">Loading Data Using the candle.file_utils Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="git-branch-tag-names.html">GitHub branch and tag names and definitions</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-candle-data-dir.html">Tutorial CANDLE_DATA_DIR</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to run a container</a></li>
<li class="toctree-l1"><a class="reference internal" href="building-containers.html">How to build a container</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploying-containers.html">How to deploy a container</a></li>
<li class="toctree-l1"><a class="reference internal" href="drp_overview.html">Drug Response Prediction</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_curation.html">Model Curation</a></li>
<li class="toctree-l1"><a class="reference internal" href="curated_models.html">Curated Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgment.html">Acknowledgments</a></li>
<li class="toctree-l1"><a class="reference internal" href="chia_touch.html">DEF</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IMPROVE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">How to run a container</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/content/running-containers.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="how-to-run-a-container">
<h1>How to run a container<a class="headerlink" href="#how-to-run-a-container" title="Permalink to this headline">¶</a></h1>
<p>General Form:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span>singularity exec –nv –bind $HOST_DATA_DIR:/candle_data_dir $IIL/$IMAGE $CMD $ARGS
</pre></div>
</div>
</div></blockquote>
<p>Use case 1. A custom model  file is provided as an argument to train.sh.</p>
<p>Example:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">singularity</span> <span class="n">exec</span> <span class="o">--</span><span class="n">nv</span> <span class="o">--</span><span class="n">bind</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">brettin</span><span class="o">/</span><span class="n">improve_data_dir</span><span class="p">:</span><span class="o">/</span><span class="n">candle_data_dir</span> \
     <span class="o">/</span><span class="n">software</span><span class="o">/</span><span class="n">improve</span><span class="o">/</span><span class="n">images</span><span class="o">/</span><span class="n">GraphDRP</span><span class="p">:</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="mf">20221109.</span><span class="n">sif</span>                    \
     <span class="n">train</span><span class="o">.</span><span class="n">sh</span> <span class="mi">2</span> <span class="o">/</span><span class="n">candle_data_dir</span> <span class="n">GraphDRP</span><span class="o">/</span><span class="n">graphdrp_default_model</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</div></blockquote>
<table class="colwidths-auto docutils align-center" id="id1">
<caption><span class="caption-text">Options</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>Parameters</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>–nv</p></td>
<td><p>This option instructs Singularity to use the host NVidia drivers and cuda libraries.</p></td>
</tr>
<tr class="row-odd"><td><p>–bind</p></td>
<td><p>This option instructs Singularity to mount a host file system inside the container. The mount point inside the container will always be candle_data_dir.</p></td>
</tr>
<tr class="row-even"><td><p>GraphDRP:0.0.1-20221109.sif</p></td>
<td><p>This is the Singularity image that contains the GraphDRP model code.</p></td>
</tr>
<tr class="row-odd"><td><p>train.sh</p></td>
<td><p>This is the command that runs inside the container. All containers will have this command. All arguments to follow are passed to train.sh.</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>This is the host GPU device id to be used by code running inside the container. The value is used to set the CUDA_VISIBLE_DEVICES environment variable inside the container.</p></td>
</tr>
<tr class="row-odd"><td><p>candle_data_dir</p></td>
<td><p>The value of the CANDLE_DATA_DIR environment variable that is set inside the container. This enables candle_lib code running inside the container to rewrite input and output paths so that inputs and outputs will be saved on the host’s file system.</p></td>
</tr>
<tr class="row-even"><td><p>GraphDRP/graphdrp_default_model.txt</p></td>
<td><p>This is a custom model file created and saved on the host’s filesystem. The location of the file is relative to CANDLE_DATA_DIR</p></td>
</tr>
</tbody>
</table>
<p>Use Case 2: Train a model with the default model file.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">singularity</span> <span class="n">exec</span> <span class="o">--</span><span class="n">nv</span> <span class="o">--</span><span class="n">bind</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">brettin</span><span class="o">/</span><span class="n">candle_data_dir</span><span class="p">:</span><span class="o">/</span><span class="n">candle_data_dir</span> \
    <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">brettin</span><span class="o">/</span><span class="n">Singularity</span><span class="o">/</span><span class="n">sandboxes</span><span class="o">/</span><span class="n">GraphDRP</span><span class="o">-</span><span class="n">GraphDRP</span><span class="p">:</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="mi">20221028</span>    \
    <span class="n">train</span><span class="o">.</span><span class="n">sh</span> <span class="mi">2</span> <span class="o">/</span><span class="n">candle_data_dir</span>
</pre></div>
</div>
</div></blockquote>
<p>Because the number of positional arguments to train.sh is 2, the default model file in the model directory inside the container is used. It still expects /candle_data_dir to be available inside the container as /candle_data_dir is prepended to input and output paths. The default model file would be the one used to closely reproduce the original authors results.</p>
<p>Use Case 3: Train a model using supported command line arguments.</p>
<p>In this case, the default model file in the model directory inside the container is read first, and then command line arguments passed to train.sh are used. In the event that both the default model file and the command line arguments contain the same parameter, the command line parameter’s value will take precedence. The first two positional arguments to train.sh must still always be the GPU device id and the mount point inside the container as specified by the –bind option.</p>
<p>In this use case, train.sh shifts the two positional arguments $1 and $2 and then simply pass the remaining args in $&#64; to the model python script.</p>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="using-candle-data-dir.html" class="btn btn-neutral float-left" title="Tutorial CANDLE_DATA_DIR" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="building-containers.html" class="btn btn-neutral float-right" title="How to build a container" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, IMPROVE Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>