<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loading Data Using the candle.file_utils Module &mdash; IMPROVE 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=e031e9a9"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            IMPROVE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="whatis.html">What is the IMPROVE project?</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="applications.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="acknowledgment.html">Acknowledgments</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IMPROVE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Loading Data Using the candle.file_utils Module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/content/candle_2.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="loading-data-using-the-candle-file-utils-module">
<h1>Loading Data Using the candle.file_utils Module<a class="headerlink" href="#loading-data-using-the-candle-file-utils-module" title="Permalink to this heading">Â¶</a></h1>
<p>We saw in the previous example how to create a candle benchmark. Now we will use
the <code class="docutils literal notranslate"><span class="pre">candle.file_utils</span></code> methods to set up our input and output directories. Building
on the previous example, we will extend our Example model to load data. The general
functionality is that if the data exists in the data directory, use it, otherwise download
it and then use it.</p>
<hr class="docutils" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set up input and output directory paths. These will always be</span>
<span class="c1"># relative to os.environ[&#39;CANDLE_DATA_DIR&#39;].</span>
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">gParameters</span><span class="p">[</span><span class="s2">&quot;data_dir&quot;</span><span class="p">]</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="n">gParameters</span><span class="p">[</span><span class="s2">&quot;output_dir&quot;</span><span class="p">]</span>
<span class="c1"># the following is incorrect and appends extra subdirectories to the path</span>
<span class="c1"># data_dir, output_dir = directory_tree_from_parameters(gParameters)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;data_dir: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">output_dir: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">))</span>

<span class="c1"># prints:</span>
<span class="c1"># data_dir:   /tmp/improve_data_dir/Example/Data</span>
<span class="c1"># putput_dir: /tmp/improve_data_dir/Example/Output/EXP000/RUN000</span>

<span class="c1"># Get machine learning data</span>
<span class="n">download_filepath</span> <span class="o">=</span> <span class="n">candle</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span>
    <span class="n">gParameters</span><span class="p">[</span><span class="s1">&#39;train_data&#39;</span><span class="p">],</span>
    <span class="n">gParameters</span><span class="p">[</span><span class="s1">&#39;data_url&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">gParameters</span><span class="p">[</span><span class="s1">&#39;train_data&#39;</span><span class="p">]</span>
    <span class="n">datadir</span> <span class="o">=</span> <span class="n">data_dir</span>  <span class="c1"># This puts the files in correct path</span>
    <span class="n">cache_subdir</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># This prevents get_file from creating another subdirectory</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;download_path: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">download_filepath</span><span class="p">))</span>

<span class="c1"># prints:</span>
<span class="c1"># download_path: /tmp/improve_data_dir/Example/Data/example.csv</span>
</pre></div>
</div>
<hr class="docutils" />
<p>The code above uses the environment variable CANDLE_DATA_DIR as the root to all input
and output paths.</p>
<p>Two new keyword = value pairs are needed in the default model file - <code class="docutils literal notranslate"><span class="pre">example_default_model.txt</span></code>. These are
<code class="docutils literal notranslate"><span class="pre">data_url</span></code> and <code class="docutils literal notranslate"><span class="pre">train_data</span></code>. Additionally, I had to upload <code class="docutils literal notranslate"><span class="pre">example.csv</span></code> to
<a class="reference external" href="https://ftp.mcs.anl.gov/pub/candle/public/improve/examples">https://ftp.mcs.anl.gov/pub/candle/public/improve/examples</a></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># set location and name of training data
data_url=&quot;https://ftp.mcs.anl.gov/pub/candle/public/improve/examples&quot;
train_data=&quot;example.csv&quot;
</pre></div>
</div>
<hr class="docutils" />
<p>Putting this together into a running example looks like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">candle</span>
<span class="c1"># from candle.file_utils import directory_tree_from_parameters</span>
<span class="c1"># from candle.file_utils import get_file</span>
<span class="c1"># from candle import Benchmark</span>
<span class="c1"># from candle import finalize_parameters</span>

<span class="c1"># set CANDLE_DATA_DIR env var. This is normally set externally.</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CANDLE_DATA_DIR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;/tmp/improve_data_dir&#39;</span>

<span class="c1"># get the directory of this script, so that the default_model.txt</span>
<span class="c1"># file can be found when the benchmark is instanciated.</span>
<span class="n">filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>

<span class="n">imp_bmk</span><span class="o">=</span><span class="n">candle</span><span class="o">.</span><span class="n">Benchmark</span><span class="p">(</span>
    <span class="n">filepath</span><span class="o">=</span><span class="n">filepath</span><span class="p">,</span>
    <span class="n">defmodel</span><span class="o">=</span><span class="s2">&quot;example_default_model.txt&quot;</span><span class="p">,</span>
    <span class="n">framework</span><span class="o">=</span><span class="s2">&quot;tensorflow&quot;</span>
<span class="p">)</span>

<span class="c1"># Initialize parameters</span>
<span class="n">gParameters</span> <span class="o">=</span> <span class="n">candle</span><span class="o">.</span><span class="n">finalize_parameters</span><span class="p">(</span><span class="n">imp_bmk</span><span class="p">)</span>

<span class="c1"># Set up input and output directory paths. These will always be</span>
<span class="c1"># relative to os.environ[&#39;CANDLE_DATA_DIR&#39;].</span>
<span class="c1"># data_dir, output_dir = directory_tree_from_parameters(gParameters)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;data_dir: </span><span class="si">{}</span><span class="se">\n</span><span class="s1">output_dir: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gParameters</span><span class="p">{</span><span class="s2">&quot;data_dir&quot;</span><span class="p">],</span> <span class="n">gParameters</span><span class="p">{</span><span class="s2">&quot;output_dir&quot;</span><span class="p">]))</span>

<span class="c1"># data_dir:   /tmp/improve_data_dir/Example/Data</span>
<span class="c1"># putput_dir: /tmp/improve_data_dir/Example/Output/EXP000/RUN000</span>

<span class="c1"># Get machine learning data</span>
<span class="n">download_filepath</span> <span class="o">=</span> <span class="n">candle</span><span class="o">.</span><span class="n">get_file</span><span class="p">(</span>
    <span class="n">gParameters</span><span class="p">[</span><span class="s1">&#39;train_data&#39;</span><span class="p">],</span>
    <span class="n">gParameters</span><span class="p">[</span><span class="s1">&#39;data_url&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="n">gParameters</span><span class="p">[</span><span class="s1">&#39;train_data&#39;</span><span class="p">]</span>
    <span class="n">datadir</span> <span class="o">=</span> <span class="n">data_dir</span>  <span class="c1"># This puts the files in correct path</span>
    <span class="n">cache_subdir</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># This prevents get_file from creating another subdirectory</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;download_path: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">download_filepath</span><span class="p">))</span>
</pre></div>
</div>
<p>This code produces the following output. The first output, model_name and Params come
from the call to finalize_parameters. The rest is print statements in the code above.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ python ./example.py

model name:  &quot;Example&quot;

Params:
{&#39;ckpt_checksum&#39;: False,
&#39;ckpt_directory&#39;: &#39;./save&#39;,
&#39;ckpt_keep_limit&#39;: 1000000,
&#39;ckpt_keep_mode&#39;: &#39;linear&#39;,
&#39;ckpt_restart_mode&#39;: &#39;auto&#39;,
&#39;ckpt_save_best&#39;: True,
&#39;ckpt_save_best_metric&#39;: &#39;val_loss&#39;,
&#39;ckpt_save_interval&#39;: 0,
&#39;ckpt_save_weights_only&#39;: False,
&#39;ckpt_skip_epochs&#39;: 0,
&#39;data_dir&#39;: &#39;/tmp/improve_data_dir/Example/Data&#39;,
&#39;data_type&#39;: &lt;class &#39;numpy.float32&#39;&gt;,
&#39;data_url&#39;: &#39;https://ftp.mcs.anl.gov/pub/candle/public/improve/examples&#39;,
&#39;experiment_id&#39;: &#39;EXP000&#39;,
&#39;logfile&#39;: None,
&#39;model_name&#39;: &#39;Example&#39;,
&#39;output_dir&#39;: &#39;/tmp/improve_data_dir/Example/Output/EXP000/RUN000&#39;,
&#39;profiling&#39;: False,
&#39;rng_seed&#39;: 7102,
&#39;run_id&#39;: &#39;RUN000&#39;,
&#39;shuffle&#39;: False,
&#39;timeout&#39;: -1,
&#39;train_bool&#39;: True,
&#39;train_data&#39;: &#39;example.csv&#39;,
&#39;verbose&#39;: False}

data_dir: /tmp/improve_data_dir/Example/Data
output_dir: /tmp/improve_data_dir/Example/Output/EXP000/RUN000
download_path: /tmp/improve_data_dir/Example/Data/example.csv
</pre></div>
</div>
<p>The code for this example can be found at <a class="reference external" href="https://github.com/JDACS4C-IMPROVE/docs/tree/main/example_code">https://github.com/JDACS4C-IMPROVE/docs/tree/main/example_code</a>
in the example.py and example_default_model.txt files.</p>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, IMPROVE Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>